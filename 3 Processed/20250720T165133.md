# 1. Design Principles

| Principle                 | Implementation                                            |
| ------------------------- | --------------------------------------------------------- |
| **Minimal Core**          | Only a few required keys.                                 |
| **Namespaced Extensions** | Optional blocks with prefixes (`life:`, `class:`, etc.).  |
| **Stable Identity**       | Sortable `uid`; filename = `uid`.                         |
| **Immutable vs Mutable**  | Immutable (`uid`, `created`), mutable (`updated`, `rev`). |
| **Versioned Schema**      | `schema: 1`; bump only for breaking changes.              |
| **Automation First**      | Machine-managed fields (`updated`, `keywords_auto`).      |
| **Orthogonal Layers**     | Lifecycle ≠ Status ≠ Classification.                      |
| **Graceful Degradation**  | Missing blocks never break processes.                     |

---

# 2. Core vs Extensions

**Core (mandatory):**
`schema`, `uid`, `title`, `owner`, `created`, `updated`, `rev`.

**Extensions (optional):**

* `life:` lifecycle stage, status, project linkage.
* `class:` topics, tags, facets.
* `link:` explicit UID-based relations.
* `desc:` summary, auto keywords, word count, lang.
* `src:` sources, refs, capture method.
* `sec:` sensitivity, retention, license.
* `meta:` ephemeral usage metrics.
* `auto:` flags for pipelines.
* `x_*:` custom future blocks.

---

# 3. YAML Skeleton (excerpt)

```yaml
schema: 1
uid: 20250720132541
title: Deep Work Retrospective
owner: hk
created: 2025-07-20T13:25:41+02:00
updated: 2025-07-20T14:07:09+02:00
rev: 3

life:
  stage: work
  status: draft
  project: P2025-003-Deep_Work
  sprint: 2025-W30
  due: 2025-07-31

class:
  topics: [Productivity, Cognitive_Science]
  tags: [method, retrospective]
  facets: { type: retrospective, effort_size: small }

desc:
  summary: >
    Key insights from applying Deep Work principles over 2 weeks.
  keywords_auto: [deep work, focus, distraction, context switching]
  words: 842
  lang: en

sec:
  sensitivity: normal
  retention: retain
  license: CC-BY-4.0
```

---

# 4. Field Rules

* `uid`: immutable, never reused.
* `rev`: increment on meaningful change.
* `updated`: auto-overwritten on content changes.
* `life.stage`: must match folder.
* `class.topics`: controlled list; `tags`: free-form, non-duplicative.
* `link`: only UIDs, ≤2 parents.
* `desc.keywords_auto`: auto-regenerated.

---

# 5. Templates

**Capture (bare minimum):** core + `life.stage=capture`, `status=idea`.
**Project note:** add `life.project`, `class.tags=[project]`, `sec.sensitivity=internal`.
**Concept note:** library stage, controlled topics, `link` to parents, public by default.

---

# 6. Automation Pipeline

* On create: insert template.
* On save: update `updated`, `rev`, `words`.
* On move: sync `life.stage`.
* Nightly: rebuild `keywords_auto`, audit classification.
* Weekly: flag expired `sec.review_on`.
* Monthly: orphan check (`library` notes without parents or backlinks).

---

# 7. Evolution Strategy

* Prefer additive extensions (`vec:` etc.).
* Bump schema only on breaking changes.
* Use `# DEPRECATED` markers before full removal.

---

# 8. Migration

1. Map old IDs/timestamps → `uid`, `created`.
2. Fold `status`/`type` into `class.tags`.
3. Derive stage from folder.
4. Extract summary (fallback: first sentence).
5. Init `rev:1`, set `updated=created` if missing.
6. Bulk-generate `keywords_auto`.
7. Add `schema:1`.

---

# 9. Cheat Sheet

* **Always edit:** `title`, `summary`, `life.stage`, `status`.
* **Occasionally:** `topics`, `tags`, `project`.
* **Never manually:** `uid`, `created`, `updated`, `rev`, `keywords_auto`, `meta`.

---

# 10. Advantages vs Old Schema

* Consolidated into structured blocks.
* Status/type clutter resolved in `life` and `class`.
* Keywords fully automated.
* Growth path via namespaced blocks.
* Relationships robust through UID-only `link`.

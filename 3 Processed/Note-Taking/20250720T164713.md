# Design Principles (Condensed)

**Core Goals**

* **Minimal Core**: Only a few mandatory keys.
* **Namespaced Extensions**: Optional, short prefixes (`life`, `class`, `link`, etc.) prevent collisions.
* **Stable Identity**: Immutable `uid` = filename; no dependence on title.
* **Immutable vs Mutable**: Split immutable (`uid`, `created`) vs mutable (`updated`, `rev`).
* **Versioned Schema**: `schema: 1`, increment only for breaking changes.
* **Automation First**: Machines manage auto-fields (`updated`, `keywords_auto`).
* **Orthogonal Semantics**: Lifecycle ≠ Status ≠ Classification.
* **Graceful Degradation**: Missing blocks cause no breakage.

---

# Core vs Extensions

**Core (always required):**
`schema`, `uid`, `title`, `owner`, `created`, `updated`, `rev`.

**Extensions (optional):**

* `life:` lifecycle, status, project link
* `class:` topics (controlled), tags (free), facets (key\:value)
* `link:` relations (uids only; max 2 parents)
* `desc:` summary, auto-keywords, word count, lang
* `src:` provenance, refs, URLs, capture method
* `sec:` sensitivity, retention, license
* `meta:` usage metrics (ephemeral, rebuildable)
* `auto:` export/embedding/locks
* `x_<namespace>:` custom future blocks

---

# Canonical YAML Skeleton (Abbreviated)

```yaml
schema: 1
uid: 20250720132541
title: Deep Work Retrospective
owner: hk
created: 2025-07-20T13:25:41+02:00
updated: 2025-07-20T14:07:09+02:00
rev: 3

life:
  stage: work
  status: draft
  project: P2025-003-Deep_Work
  sprint: 2025-W30
  due: 2025-07-31

class:
  topics: [Productivity, Cognitive_Science]
  tags: [method, retrospective]
  facets: { type: retrospective, effort_size: small }

link:
  broader: [20240405121530]
  related: [20240614144702]

desc:
  summary: Key insights from a 2-week Deep Work experiment.
  keywords_auto: [deep work, focus, distraction, context switching]
  words: 842
  lang: en

src:
  origin: self
  refs: [Newport2016DeepWork, 10.1145/1234567]
  urls: [https://calnewport.com/deep-work/]
  captured_via: manual

sec:
  sensitivity: normal
  retention: retain
  license: CC-BY-4.0

meta:
  last_opened: 2025-07-20T14:06:40+02:00
  open_count: 5
  referenced_by: 12

auto:
  export: true
  ai_embedding: queued
  lock: false
```

---

# Governance Notes

* **`rev`** increments only for substantive changes.
* **`updated`** set automatically on content changes.
* **`class.topics`** controlled list; tags must not duplicate topics.
* **`desc.keywords_auto`**, `meta`, and counts are automation-only.
* **`src.refs`** should map to citation library.
* **`sec.review_on`** enables automated governance checks.

---

# Automation Pipeline

* **On create**: template insertion
* **On save**: auto-update `updated`, `rev`, `words`
* **On folder move**: sync `life.stage` with path
* **Nightly**: refresh keywords, run classification audit
* **Weekly**: governance audit (retention, overdue)
* **Monthly**: orphan check on library notes

---

# Evolution Strategy

* Add new blocks (`vec:` etc.) instead of altering existing ones.
* Bump `schema` only for meaning changes or removals.
* Mark deprecated keys until migration complete.

---

# Migration (Old → New)

1. Map IDs/timestamps → `uid`, `created`.
2. Normalize old `status`/`type` → `class.tags`.
3. Derive `life.stage` from folder path.
4. Seed `summary` from first sentence.
5. Init `rev: 1`, `updated = created`.
6. Generate initial `keywords_auto`.
7. Add `schema: 1` globally.

---

# Cheat Sheet

* **Always edit**: `title`, `summary`, `stage`
* **Occasional**: `topics`, `tags`, `status`
* **Never manual**: `uid`, `created`, `updated`, `rev`, auto fields

---

# Key Improvements vs Old Schema

* Standalone keys consolidated into blocks.
* Lifecycle, status, and type clarified.
* Keywords automated.
* Extensions future-proof without churn.
* Linking explicit and uid-based.

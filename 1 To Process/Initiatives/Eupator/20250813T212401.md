---
owner: Ben Jendyk
id: a5e53bdc-60d8-4106-bf54-bd0cb3fa8dd1
created: 2025-08-13T21:24:01+0200
modified: 2025-08-13T21:24:02+0200
tags: [access/public, language/en]
key-words: []
---

You should have phrased it as: "Where, if at all, do Proxmox and NixOS fit into a self-hosted, standards-based rails architecture, and what is the rational adoption path for a solo founder with no prior exposure?"

  

## Bottom line

- If you start on a single cloud VM, skip Proxmox. Consider NixOS only if you want fully declarative OS builds now; otherwise use Debian/Ubuntu and revisit NixOS later.
- If you run your own bare-metal, use Proxmox as the hypervisor. Run your services inside VMs (or LXC) and optionally make those VMs NixOS for reproducibility.
- Do not adopt both at day zero unless you're comfortable paying the learning tax. Start minimal, leave a clean migration path.

  

## Quick mental model

- Proxmox: pragmatic, batteries-included virtualization platform. Gives you VM/LXC lifecycle, snapshots, live migration (with shared storage), and built-in backup (PBS). It's an infrastructure substrate, not an app platform.
- NixOS: declarative OS. Every package, service, user, and config is code; rollbacks are trivial. It's an OS-level configuration system, not a hypervisor.

  

They are complementary: Proxmox manages machines; NixOS ensures each machine is exactly as declared.

  

## Decision rules (fast)

- Cloud VM only, months 0--3:

Use Debian/Ubuntu + Docker Compose. Add NixOS later if you want stronger immutability. Proxmox adds nothing on a rented VM.
- Single on-prem box:

Install Proxmox on the hardware. Create a "core" VM for your stack. Choose Debian for lowest friction or NixOS for maximum reproducibility.

- You need easy DR of whole machines and may add a second host soon:

Proxmox + PBS is the simplest way to back up/restore entire VMs. NixOS doesn't replace that; it complements it.
- You want zero config drift and auditable infra state:

NixOS is the right lever. Start with the core VM; extend to others when comfortable.

  

## Minimal viable setups

  

### A. Cloud VM start (recommended for week 1)

- Substrate: 1 VM (4 vCPU, 16 GB RAM, 200 GB disk).
- OS: Debian 12 (or NixOS if you're ready).
- Services: Docker/Podman + Compose for Gitea/GitHub runner, MinIO, Postgres, Keycloak, NATS, Caddy, Prometheus.
- Backups: nightly Postgres dumps + MinIO replication to a different S3-compatible provider; VM snapshots daily.
- Migration path: later replace Debian with NixOS in-place (cutover during a scheduled window) without touching service containers.

  

### B. Single bare-metal host (home lab or colo)

- Install Proxmox on the metal. ZFS mirror if you have two disks; enable email alerts.
- Create VMs:

    1. core-vm (8--16 GB RAM): runs all services via Compose. OS = Debian (lowest friction) or NixOS (declarative).

    2. ci-vm (4--8 GB RAM): optional; isolates build runners.

    3. bastion-vm (1--2 GB RAM): WireGuard, monitoring ingress, backups orchestrator.

- Backups: deploy Proxmox Backup Server (PBS) on the same host to a separate disk, and replicate to external S3 weekly.
- Network: one Proxmox bridge; add a WireGuard VPN for admin, expose only the reverse proxy publicly.

  

### C. Two-host resilience (later)

- Proxmox on both hosts, shared storage optional.
- Place Postgres on its own VM with regular physical snapshots + logical dumps; MinIO in another; control-plane/service VM separate.
- PBS on host-2 backing up host-1, and vice versa.

  

## Where NixOS pays off

- Core VM is NixOS: your entire rails node is rebuildable from Git in minutes. Rollbacks are safe.
- Image pipelines: use nixos-generators to build immutable VM images or OCI images; pin inputs via flakes.
- Dev envs: devShell gives repeatable toolchains for you and future hires without polluting the host.
- Policy as code: encode users, services, sysctl, firewall, WireGuard, and service units in configuration.nix. Drift goes to zero.

  

Costs:

- Steeper learning curve than Debian. Expect 1--2 focused days to become productive.
- Some niche services lack first-class NixOS modules; you'll run those in containers anyway.

  

## Where Proxmox pays off

- Full-machine DR: snapshot/backup/restore end-to-end without reinventing tooling.
- Lifecycle safety rails: clone VMs for staging, test upgrades off to the side, roll back with a click.
- Separation of concerns: infra ops (VMs, storage, networks) are cleanly split from service ops (Compose, CI, control plane).

  

Costs:

- Extra layer to learn and maintain.
- If you're only renting a single cloud VM, it's redundant.

  

## Concrete adoption paths

  

### Path 1: Minimal friction â†’ later precision

  

Week 1--2

- Cloud VM, Debian, Compose. Ship control plane and first service.
- Backups off-site. Document rebuild steps.

  

Week 3--4

- Rebuild the same VM as NixOS (parallel instance). Cut over with a short freeze.
- Encode Docker, WireGuard, users, firewall, timers in Nix. Keep services in containers.

  

Later

- If you add on-prem, introduce Proxmox then lift-and-shift the NixOS VM image.

  

### Path 2: Bare-metal now, resilient by design

  

Day 1

- Install Proxmox. Create core-vm with NixOS.
- Put everything in Nix: Docker engine, Caddy, WireGuard, Prometheus node exporter.
- Services remain Compose-managed for portability.

  

Day 2

- PBS backups of core-vm; nightly logical DB dumps and MinIO replication to S3 off-site.

  

Day 7

- Test DR: restore core-vm from PBS to a fresh Proxmox install on a laptop or second box. Fix gaps.

  

## Practical module sketch (NixOS core VM)

- Enable Docker, Caddy, WireGuard, users, firewall, backups.
- Keep Compose files in your infra-bootstrap repo; NixOS manages the service that runs docker compose up at boot and restarts on change.
- Secrets via sops-nix pulling from your Git repo; age keys on a hardware token.

  

## Risk and time accounting

- Proxmox only: ~0.5--1 day to competence if you've used hypervisors before.
- NixOS only: ~1--2 days to competence for a disciplined engineer.
- Both together from zero: expect ~3--4 days to be safe. Do this only if you're on bare-metal and committed to declarative ops.

  

## Make the call

- Renting a single VM and want speed: Debian today, keep Compose, revisit NixOS later.
- Bare-metal and want strong DR: Proxmox now, Debian or NixOS inside VMs.
- Long-term desire for bulletproof reproducibility: NixOS somewhere in the stack is worth it; adopt gradually.

  

If you want the exact NixOS config for a "core VM" that boots WireGuard, Docker, Caddy, Postgres, MinIO, and Keycloak, I can provide it inline with a matching Compose file and a Proxmox VM spec so you can build the whole base without guesswork.
---
owner: Ben Jendyk
id: <% tp.user.createUUID() %>
created: 2025-07-31T04:38:00+0200
modified: 2025-07-31T04:38:03+0200
tags: [access/public, language/en]
key-words: []
---

Below is a **minimal, works-today setup** that uses **ONLY the Obsidian core API** ( `app.fileManager.processFrontMatter` ) + a tiny helper to keep the YAML/body mirror up-to-date.  
No third-party parsing libraries, no brittle regex surgery.

* * *

## 0 Prerequisites

- **Templater** -- to execute JavaScript snippets.
- **Dataview** -- to _read_ YAML into the body (no writing).  
_(You do **not** need MetaEdit, js-yaml, etc. for the code below.)_
* * *

## 1 Folder layout
    
    
    00_System/
    └─ Templates/
       ├─ _core.md
       ├─ blocks/
       │   ├─ flow.md
       │   ├─ taxonomy.md
       │   └─ links.md
       └─ scripts/
           └─ block-helper.js
    

Set **Templater → "Template folder location"** to `00_System/Templates`.
* * *

## 2 `block-helper.js` (put in `00_System/Templates/scripts/`)
    
    
    /*
      ensureBlock(tp, {
        block:      "flow",            // YAML key & body heading
        heading:    "Flow",            // Human heading (no number)
        defaults:   { stage:"capture"},// patch into YAML if missing
        dvSnippet:  "TABLE ...",       // Dataview code to render
      })
    */
    module.exports = async (tp, opts) => {
      const {block, heading, defaults = {}, dvSnippet = ""} = opts;
    
      /* ---------- 1. PATCH FRONT-MATTER ---------- */
      const file = app.vault.getAbstractFileByPath(tp.file.path());
      await app.fileManager.processFrontMatter(file, (fm) => {
        fm[block] = Object.assign({}, defaults, fm[block] ?? {});
      });
    
      /* ---------- 2. INSERT / ENSURE BODY SECTION ---------- */
      const md     = await tp.file.content();
      const hRegex = new RegExp("^##\\s\\d+\\s" + heading + "$", "m");
    
      if (!hRegex.test(md)) {
        // count existing mirrored headings to get next number
        const n = (md.match(/^##\s\d+\s.+$/gm) || []).length + 1;
        const section = [
          "",                                   // insure blank line before
          `## ${n} ${heading}`,
          dvSnippet ? "```dataview" : "",
          dvSnippet,
          dvSnippet ? "```" : "",
          ""                                    // blank line after
        ].join("\n");
        await tp.file.append(section);
      }
    
      return "";      // don't insert raw JS into the note
    };
    

_Why this works_  
`app.fileManager.processFrontMatter()` is the **official** mutable front-matter API--no YAML parsing needed.
* * *

## 3 Block template example -- `blocks/flow.md`
    
    
    <%*
    await tp.user.block_helper({
      block: "flow",
      heading: "Flow",
      defaults: {stage: "capture", status: "idea"},
      dvSnippet:
    `TABLE
      flow.stage  AS Stage,
      flow.status AS Status,
      flow.project AS Project,
      flow.due    AS Due
    WHERE file.path = this.file.path`
    });
    %>
    

_Run this template_ and you get:

1. YAML:
    
        flow:
      stage: capture
      status: idea
    

2. Body (added once, never duplicated):
    
        ## N Flow
    ```dataview
    TABLE flow.stage AS Stage, ...
    

* * *

## 4 Core-note scaffold -- `_core.md`
    
    
    ---
    schema: 2
    core:
      uid: <% tp.date.now("YYYYMMDDHHmmss") %>
      title: <% tp.file.title() %>
      owner: hk
      created: <% tp.date.now("YYYY-MM-DDTHH:mm:ssZZ") %>
      updated: <% tp.date.now("YYYY-MM-DDTHH:mm:ssZZ") %>
      rev: 1
    flow:
      stage: capture
      status: idea
    ---
    
    # <% tp.file.title() %>
    
    <%*
    await tp.user.block_helper({
      block: "core",
      heading: "Core",
      dvSnippet:
    `TABLE core.uid AS UID, core.owner AS Owner, core.rev AS Rev
    WHERE file.path = this.file.path`
    });
    %>
    

Set this as your default **New-Note** template in Templater.
* * *

## 5 Using it day-to-day

| Need | Command (set hotkeys) | 
| ---- | ----  |
| Create note | "New Core Note" (`_core.md`) | 
| Update / add Flow block | "Add Flow" (`blocks/flow.md`) | 
| Add Taxonomy block | "Add Taxonomy" | 
| Add Links block | "Add Links" | 

Each command:

1. Merges / patches front-matter safely.

2. Inserts its body section once (or leaves it if present).

3. Dataview renders live values; you _never_ re-type them.

* * *

## 6 Stop duplication, keep sync

- **YAML is source of truth.**
- Body only _displays_ YAML fields via Dataview.
- You edit structured data by re-running the block template or via MetaEdit.
- Title & timestamps can be mirrored with a pre-save Linter rule (optional).
* * *

## 7 Troubleshooting tips

- **Template injects JS into note?**

    - Make sure the helper returns an empty string (`return "";`).
- **Front-matter not patching?**

    - Check file is saved first; processFrontMatter needs a physical file.
- **Duplicate headings?**

    - Helper counts existing `## <number>` headings; if you manually change numbers, re-run template once to realign.
* * *

### TL;DR

_Use Obsidian's own_ `app.fileManager.processFrontMatter` _for YAML writes,_  
_Templater + a 30-line helper_ to add body sections exactly once, and **Dataview** to display YAML values.  
That's all you need for a robust, auto-synced, mirrored note system.
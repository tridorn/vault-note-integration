# Unified Note Architecture (Mirrored Metadata + Body)

## Principles

* **Single ontology of blocks**: canonical set (`identity`, `life`, `class`, `link`, `desc`, `src`, `sec`, `meta`, `auto`, `x_*`).
* **Bi-directional parity**: each YAML block has one mirrored body section, numbered.
* **No orphans**: YAML key without body elaboration or vice versa is flagged.
* **Readable without YAML**: body conveys minimal context alone.
* **Composable**: new YAML block auto-implies new body section.
* **Deterministic order**: append-only, never reorder.

## Canonical Block Order (v1)

1. identity
2. life
3. class
4. link
5. desc
6. src
7. sec
8. meta
9. auto
10. x\_\* (alphabetical, appended only)

## Schema Example

YAML holds machine data; body sections mirror with numeric headers, short narrative or tables.

* YAML identity: `uid`, `title`, `owner`, `rev`
* Body: lists UID, revision, short rationale.
* Same principle applies to life (stage/status), class (topics/tags), link (relations), desc (summary + detail), src (refs/urls), sec (policy), meta (metrics), auto (machine-owned).

## Mapping Contract

| Block    | Section | Must exist           | Human content       | Machine edits   |
| -------- | ------- | -------------------- | ------------------- | --------------- |
| identity | ##1     | always               | optional rationale  | core fields     |
| life     | ##2     | if staged            | lifecycle notes     | stage/status    |
| class    | ##3     | if tags/topics       | justification       | vocab audit     |
| link     | ##4     | if relationships     | graph narrative     | parent rules    |
| desc     | ##5     | if summary           | explanatory content | computed fields |
| src      | ##6     | if sources           | commentary          | normalization   |
| sec      | ##7     | if non-public/policy | governance note     | scheduler       |
| meta     | ##8     | optional             | interpret metrics   | refresh counts  |
| auto     | ##9     | optional             | none                | machine-owned   |
| x\_\*    | ##N     | if block exists      | domain explanation  | domain scripts  |

## Workflow (Atomic)

* **Capture**: create identity, life.stage=capture, optional summary.
* **Triage/Nurture**: update stage, optional body note.
* **Link project**: add life.project.
* **Library promotion**: life.stage=library, add class, flesh desc/link.
* **Enrich**: add src refs, commentary.
* **Archive**: set stage=archive, optional reason.

## Automation Rules

* Integrity script checks heading parity.
* Round-trip sync: identity flows YAML→body; title syncs body→YAML; stage/status validated both ways; computed fields body→YAML.
* Append-only evolution: new block appended, schema version updated.

## Advantages

* **Cognitive clarity**: fixed location for each info type.
* **Auditability**: diffs show structural vs reasoning changes.
* **AI integration**: clear targets for automation.
* **Refactoring safety**: body retains rationale if classification logic shifts.
* **Tool neutral**: plain Markdown remains legible.

## Pitfalls & Mitigations

* Duplication fatigue → body holds elaboration, not verbatim.
* Stale divergence → pre-commit integrity checks.
* Section bloat in simple notes → compact mode (only 1–2).
* Manual edits in auto → mark “machine-owned”.

## Templates

* **Minimal (Capture)**: identity + life.
* **Evergreen (Library)**: full expanded form.

## Migration

* Map old YAML into blocks, generate missing sections, insert numeric headers, summarize desc if missing, backfill identity.rev + life.stage, validate.

## Extensions

* New namespaces (e.g. `x_research`, `x_finance`, `pub`) append as new mirrored blocks.

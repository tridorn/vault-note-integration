---
owner: Ben Jendyk
id: <% tp.user.createUUID() %>
created: 2025-07-21T20:22:22+0200
modified: 2025-07-21T20:22:25+0200
tags: [access/public, language/en]
key-words: []
---

Below is a **from‑scratch, battle‑tested implementation plan** for a _dually‑mirrored_ note system in Obsidian.  
It keeps YAML as **source of truth**, renders body snippets **from** that YAML, and lets you add or edit blocks with one command--no double‑typing.
* * *

## 0 Toolchain (all free community plugins)

| Plugin | Why you need it | 
| ---- | ----  |
| **Templater** | Runs JavaScript, edits front‑matter, inserts body text. | 
| **Dataview** | Pulls YAML into live tables / badges inside body sections. | 
| **MetaEdit** _(optional)_ | Handy for ad‑hoc YAML key tweaks from Command Palette. | 
| **QuickAdd** _(optional)_ | One‑click macros (e.g., "Promote to Library"). | 
| **Linter** | Time‑stamp & word‑count auto‑updates on save. | 

_(No other plugins required--BreadCrumbs etc. optional.)_

* * *

## 1 Folder layout inside your vault
    
    
    00_System/
    │
    ├─ Templates/
    │   ├─ _core.md                  # new‑note scaffold
    │   ├─ blocks/
    │   │   ├─ flow.md
    │   │   ├─ taxonomy.md
    │   │   ├─ links.md
    │   │   ├─ content.md
    │   │   └─ ... (one per block)
    │   └─ scripts/
    │       └─ block-helper.js       # single JS helper every block reuses
    └─ Guides/
        └─ block-taxonomy-v2.md
    

Set **Templater → Template folder** = `00_System/Templates`  
Set **Templater → User scripts folder** = `00_System/Templates/scripts`
* * *

## 2 The shared helper (`block-helper.js`)
    
    
    /**
     * tp.user.ensureBlock({
     *   block:      "flow",                    // REQUIRED (matches YAML key + heading)
     *   heading:    "Flow",                    // REQUIRED (H1‑style, no number prefix)
     *   yamlPatch:  {stage: "capture"},        // OPTIONAL default fields
     *   dvSnippet:  "<dataview code>",         // OPTIONAL dataview text placed under heading
     * })
     */
    module.exports = async (tp, opts) => {
      const block      = opts.block;
      const hName      = opts.heading;
      const patch      = opts.yamlPatch || {};
      const dvSnippet  = opts.dvSnippet || "";
      const fm         = tp.frontmatter;           // current YAML object
    
      /* ---------- 1. UPDATE / CREATE YAML BLOCK ---------- */
      const current    = fm[block] ?? {};
      const merged     = Object.assign({}, patch, current);
      fm[block]        = merged;
      await tp.frontmatter.write(fm);              // overwrites file's YAML
    
      /* ---------- 2. INSERT / REFRESH BODY SECTION ------ */
      const fileText   = await tp.file.content();
      const headingRx  = new RegExp("^##\\s\\d+\\s" + hName + "$", "m");
      let   num        = 1;                        // compute next heading number
      const headings   = [...fileText.matchAll(/^##\s\d+\s.+$/gm)];
      if (headings.length) num = headings.length + (!headingRx.test(fileText));
    
      const sectionHdr = `## ${num} ${hName}`;
      const sectionBody = dvSnippet ? `\n\`\`\`dataview\n${dvSnippet}\n\`\`\`\n` : "\n";
      const newSection  = `\n${sectionHdr}${sectionBody}`;
    
      if (!headingRx.test(fileText)) {
        // append section at end
        await tp.file.append(newSection);
      } else {
        // heading exists: leave your narrative untouched
      }
    
      return ""; // so template inserts nothing extra at cursor
    };
    

_Why only one helper?_ -- every block template passes different parameters, but logic stays identical.
* * *

## 3 Block template example: `blocks/flow.md`
    
    
    <%*
    await tp.user.block_helper({
      block:   "flow",
      heading: "Flow",
      yamlPatch: {
        stage: "capture",
        status: "idea"
      },
      dvSnippet:
    `TABLE
      flow.stage  AS Stage,
      flow.status AS Status,
      flow.project AS Project,
      flow.due    AS Due
    WHERE file.path = this.file.path`
    });
    %>
    

1. **YAML**: ensures `flow` exists and has defaults (`stage: capture`, etc.)

2. **Body**: inserts (once) `## N Flow` heading with the Dataview table.

> **Edit stage later?** Run the same template--Templater re‑writes YAML; Dataview live table updates automatically.
* * *

## 4 Core scaffold: `_core.md`
    
    
    ---
    schema: 2
    core:
      uid: <% tp.date.now("YYYYMMDDHHmmss") %>
      title: <% tp.file.title() %>
      owner: hk
      created: <% tp.date.now("YYYY-MM-DDTHH:mm:ssZZ") %>
      updated: <% tp.date.now("YYYY-MM-DDTHH:mm:ssZZ") %>
      rev: 1
    flow:
      stage: capture
      status: idea
    ---
    
    # <% tp.file.title() %>
    
    <%*
    await tp.user.block_helper({
      block: "core",
      heading: "Core",
      dvSnippet:
    `TABLE
      core.uid     AS UID,
      core.owner   AS Owner,
      core.rev     AS Rev,
      core.created AS Created
    WHERE file.path = this.file.path`
    });
    %>
    

It pre‑writes YAML _and_ inserts Section 1 Core (Dataview badge table).

* * *

## 5 Shortcut mapping (make usage ergonomic)

| Command Palette Name | Template file                                                            | Typical hotkey |
| -------------------- | ------------------------------------------------------------------------ | -------------- |
| _New Core Note_      | `_core.md`                                                               | `Ctrl+Alt+N`   |
| _Add / Update Flow_  | `blocks/flow.md`                                                         | `Ctrl+Alt+F`   |
| _Add Taxonomy_       | `blocks/taxonomy.md`                                                     | `Ctrl+Alt+T`   |
| _Add Links_          | `blocks/links.md`                                                        | `Ctrl+Alt+L`   |
| _Promote to Library_ | QuickAdd macro that sequentially calls flow → taxonomy → links → content |                |

_(QuickAdd "Macro" type lets you chain multiple Templater templates.)_

* * *

## 6 Sync & Validation Pipeline

### 6.1 Linter (on save)

- Updates `core.updated`
- Increments `core.rev` if body content changed
- Re‑computes word count → writes to `content.words`

### 6.2 Folder move hook

- Use **Templater Folder Templates**: Assign `blocks/flow.md` as _folder template_ for each top‑level stage folder (`10_Capture/`, `40_Plan/` …).  
When you drag a file into e.g. `60_Ship/`, Templater runs the flow block and sets `flow.stage: ship`.

### 6.3 Nightly cron (optional)

- Run MetaEdit or a small Node script:

    1. Count backlinks → write `metrics.backlinks`

    2. Touch nothing else

- Body Metrics table auto‑shows new number.
* * *

## 7 Editing rules to keep everything straight

1. **Change structured data?**  
-- Trigger the block template or edit YAML with MetaEdit; _don't_ touch the Dataview snippet.

2. **Write narrative?**  
-- Type below the Dataview snippet inside that section. Scripts leave prose untouched.

3. **Title change?**  
-- Rename H1 → Linter copies to `core.title` on save.

4. **Add a brand‑new block in the future (e.g., `research`)?**

    - Create `blocks/research.md`, give it `block:"ext_research"`, `heading:"Ext Research"` → append‑only; numbering stays stable.
* * *

## 8 Typical lifecycle in practice

| Action | Keystroke / Gesture | What happens | 
| ---- | ---- | ----  |
| Quick scratch | `Ctrl+Alt+N` | Core scaffold with **Flow capture** inserted automatically | 
| Clarify next morning | `Ctrl+Alt+F` | Flow block: stage→triage; Dataview updates | 
| Commit to project | `Ctrl+Alt+F` again, set `stage: plan`, `project: P2025‑001…` in prompt |  | 
| Need taxonomy | `Ctrl+Alt+T` | Taxonomy block injected | 
| Build links | `Ctrl+Alt+L` | Links UI appears; you paste UIDs (or use Breadcrumbs UI) | 
| Promote to library | QuickAdd macro "Promote" | Flow→taxonomy→links→content blocks all enforced; file auto‑moved to `80_Library/` | 

No duplicate typing, no forgotten body section--the helper ensures symmetry.

* * *

## 9 Why this works (technical sanity check)

- **Templater runs JS in `<%* … %>` blocks** -- the code above is valid; heavy logic moved to `block-helper.js` keeps templates short.
- **Front‑matter API** -- `tp.frontmatter` methods are supported; writing a whole object is reliable.
- **Dataview** -- reads YAML live; nothing to keep in sync manually.
- **Idempotence** -- helper inserts a section only if it doesn't exist; safe to run twice.
- **Append‑only numbering** -- counts existing `##` headings, so order is automatic regardless of which block you add next.
- **Extensibility** -- new blocks = new template + one new QuickAdd entry; helper unchanged.
* * *

### TL;DR

1. **One JS helper** (`block-helper.js`) merges YAML & inserts Dataview heading once.

2. **One mini‑template per block** calls that helper with defaults.

3. **Core scaffold** runs on new note creation.

4. **Linter & folder templates** keep timestamps and stages synced automatically.

Implement those pieces and you have a fully mirrored, machine‑validated, human‑friendly note system--with zero double‑entry pain.